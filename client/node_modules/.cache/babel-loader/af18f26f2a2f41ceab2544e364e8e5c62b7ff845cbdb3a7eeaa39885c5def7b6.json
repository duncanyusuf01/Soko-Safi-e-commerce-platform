{"ast":null,"code":"// client/src/context/UserProvider.js\nimport React,{createContext,useState,useEffect,useCallback}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export const UserContext=/*#__PURE__*/createContext();export const UserProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);// ✅ Function to check session from backend\nconst checkSession=useCallback(async()=>{try{const response=await fetch('/check_session',{credentials:'include'});if(response.ok){const userData=await response.json();setUser(userData);}else{setUser(null);}}catch(error){console.error(\"Error checking session:\",error);setUser(null);}finally{setLoading(false);}},[]);// ✅ Function to manually log in a user (e.g. after successful login form)\nconst login=userData=>{setUser(userData);};// ✅ Logout\nconst logout=async()=>{await fetch('/logout',{method:'DELETE',credentials:'include'});setUser(null);};// ✅ Check session on component mount\nuseEffect(()=>{checkSession();},[checkSession]);// ✅ Context value\nconst value={user,login,logout,loading,refetchUser:checkSession};return/*#__PURE__*/_jsx(UserContext.Provider,{value:value,children:!loading&&children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","jsx","_jsx","UserContext","UserProvider","_ref","children","user","setUser","loading","setLoading","checkSession","response","fetch","credentials","ok","userData","json","error","console","login","logout","method","value","refetchUser","Provider"],"sources":["/home/yusuf12148/moringa/Soko-Safi-e-commerce-platform/client/src/context/UserProvider.js"],"sourcesContent":["// client/src/context/UserProvider.js\n\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\n\nexport const UserContext = createContext();\n\nexport const UserProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // ✅ Function to check session from backend\n  const checkSession = useCallback(async () => {\n    try {\n      const response = await fetch('/check_session', {\n        credentials: 'include',\n      });\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      } else {\n        setUser(null);\n      }\n    } catch (error) {\n      console.error(\"Error checking session:\", error);\n      setUser(null);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // ✅ Function to manually log in a user (e.g. after successful login form)\n  const login = (userData) => {\n    setUser(userData);\n  };\n\n  // ✅ Logout\n  const logout = async () => {\n    await fetch('/logout', { method: 'DELETE', credentials: 'include' });\n    setUser(null);\n  };\n\n  // ✅ Check session on component mount\n  useEffect(() => {\n    checkSession();\n  }, [checkSession]);\n\n  // ✅ Context value\n  const value = { user, login, logout, loading, refetchUser: checkSession };\n\n  return (\n    <UserContext.Provider value={value}>\n      {!loading && children}\n    </UserContext.Provider>\n  );\n};\n"],"mappings":"AAAA;AAEA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE/E,MAAO,MAAM,CAAAC,WAAW,cAAGN,aAAa,CAAC,CAAC,CAE1C,MAAO,MAAM,CAAAO,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACW,OAAO,CAAEC,UAAU,CAAC,CAAGZ,QAAQ,CAAC,IAAI,CAAC,CAE5C;AACA,KAAM,CAAAa,YAAY,CAAGX,WAAW,CAAC,SAAY,CAC3C,GAAI,CACF,KAAM,CAAAY,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,gBAAgB,CAAE,CAC7CC,WAAW,CAAE,SACf,CAAC,CAAC,CACF,GAAIF,QAAQ,CAACG,EAAE,CAAE,CACf,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAJ,QAAQ,CAACK,IAAI,CAAC,CAAC,CACtCT,OAAO,CAACQ,QAAQ,CAAC,CACnB,CAAC,IAAM,CACLR,OAAO,CAAC,IAAI,CAAC,CACf,CACF,CAAE,MAAOU,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CAC/CV,OAAO,CAAC,IAAI,CAAC,CACf,CAAC,OAAS,CACRE,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAU,KAAK,CAAIJ,QAAQ,EAAK,CAC1BR,OAAO,CAACQ,QAAQ,CAAC,CACnB,CAAC,CAED;AACA,KAAM,CAAAK,MAAM,CAAG,KAAAA,CAAA,GAAY,CACzB,KAAM,CAAAR,KAAK,CAAC,SAAS,CAAE,CAAES,MAAM,CAAE,QAAQ,CAAER,WAAW,CAAE,SAAU,CAAC,CAAC,CACpEN,OAAO,CAAC,IAAI,CAAC,CACf,CAAC,CAED;AACAT,SAAS,CAAC,IAAM,CACdY,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,CAACA,YAAY,CAAC,CAAC,CAElB;AACA,KAAM,CAAAY,KAAK,CAAG,CAAEhB,IAAI,CAAEa,KAAK,CAAEC,MAAM,CAAEZ,OAAO,CAAEe,WAAW,CAAEb,YAAa,CAAC,CAEzE,mBACET,IAAA,CAACC,WAAW,CAACsB,QAAQ,EAACF,KAAK,CAAEA,KAAM,CAAAjB,QAAA,CAChC,CAACG,OAAO,EAAIH,QAAQ,CACD,CAAC,CAE3B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}