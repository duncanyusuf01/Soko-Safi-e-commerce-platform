{"ast":null,"code":"import React,{useState,useEffect}from'react';import VendorCard from'../components/VendorCard';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function NearbyPage(){const[vendors,setVendors]=useState([]);const[selectedVendor,setSelectedVendor]=useState(null);const[location,setLocation]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchLocationAndVendors=async()=>{try{let coords={lat:-1.2921,lng:36.8219};if(navigator.geolocation){const position=await new Promise((resolve,reject)=>navigator.geolocation.getCurrentPosition(resolve,reject));coords={lat:position.coords.latitude,lng:position.coords.longitude};}setLocation(coords);await fetchNearbyVendors(coords.lat,coords.lng);}catch(err){console.error(\"Error getting location:\",err);setError(\"Could not determine your location. Showing vendors near Nairobi.\");await fetchNearbyVendors(-1.2921,36.8219);}finally{setLoading(false);}};fetchLocationAndVendors();},[]);const fetchNearbyVendors=async(lat,lng)=>{try{const response=await fetch(\"/vendors/nearby?lat=\".concat(lat,\"&lng=\").concat(lng,\"&radius=10\"));if(!response.ok)throw new Error('Failed to fetch vendors');const data=await response.json();setVendors(data);}catch(err){console.error(\"Error fetching vendors:\",err);setError(\"Failed to load nearby vendors. Please try again later.\");}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"text-center my-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner-border\",role:\"status\"})});if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"container mt-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container py-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"mb-3 text-primary\",children:\"Vendors Near You\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-info\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"mb-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Your location:\"}),' ',location?\"\".concat(location.lat.toFixed(4),\", \").concat(location.lng.toFixed(4)):'Unknown']}),vendors.length>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"mb-0\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[vendors.length,\" vendor(s)\"]}),\" within a 10 km radius\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-5 mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-secondary mb-3\",children:\"Nearby Vendors\"}),/*#__PURE__*/_jsx(\"div\",{className:\"border rounded shadow-sm p-2 bg-white\",style:{maxHeight:'520px',overflowY:'auto'},children:vendors.length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"list-group list-group-flush\",children:vendors.sort((a,b)=>a.distance-b.distance).map(vendor=>{var _vendor$products;return/*#__PURE__*/_jsxs(\"li\",{className:\"list-group-item list-group-item-action \".concat((selectedVendor===null||selectedVendor===void 0?void 0:selectedVendor.id)===vendor.id?'active':''),role:\"button\",onClick:()=>setSelectedVendor(vendor),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"strong\",{children:vendor.username}),/*#__PURE__*/_jsxs(\"span\",{className:\"badge bg-primary\",children:[vendor.distance.toFixed(1),\" km\"]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-1 text-muted small\",children:vendor.address}),/*#__PURE__*/_jsxs(\"small\",{className:\"text-secondary\",children:[((_vendor$products=vendor.products)===null||_vendor$products===void 0?void 0:_vendor$products.length)||0,\" product(s)\"]})]},vendor.id);})}):/*#__PURE__*/_jsx(\"div\",{className:\"text-muted text-center py-3\",children:\"No vendors found in your area.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-7 mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-secondary mb-3\",children:\"Vendor Details\"}),selectedVendor?/*#__PURE__*/_jsx(\"div\",{className:\"bg-light border rounded shadow-sm p-3\",children:/*#__PURE__*/_jsx(VendorCard,{vendor:selectedVendor,expanded:true})}):/*#__PURE__*/_jsx(\"div\",{className:\"border border-2 border-dashed p-5 text-center text-muted rounded\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Select a vendor from the list to view more details\"})})]})]})]});}export default NearbyPage;","map":{"version":3,"names":["React","useState","useEffect","VendorCard","jsx","_jsx","jsxs","_jsxs","NearbyPage","vendors","setVendors","selectedVendor","setSelectedVendor","location","setLocation","loading","setLoading","error","setError","fetchLocationAndVendors","coords","lat","lng","navigator","geolocation","position","Promise","resolve","reject","getCurrentPosition","latitude","longitude","fetchNearbyVendors","err","console","response","fetch","concat","ok","Error","data","json","className","children","role","toFixed","length","style","maxHeight","overflowY","sort","a","b","distance","map","vendor","_vendor$products","id","onClick","username","address","products","expanded"],"sources":["/home/yusuf12148/moringa/Soko-Safi-e-commerce-platform/client/src/pages/NearbyPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport VendorCard from '../components/VendorCard';\n\nfunction NearbyPage() {\n  const [vendors, setVendors] = useState([]);\n  const [selectedVendor, setSelectedVendor] = useState(null);\n  const [location, setLocation] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchLocationAndVendors = async () => {\n      try {\n        let coords = { lat: -1.2921, lng: 36.8219 };\n\n        if (navigator.geolocation) {\n          const position = await new Promise((resolve, reject) =>\n            navigator.geolocation.getCurrentPosition(resolve, reject)\n          );\n          coords = {\n            lat: position.coords.latitude,\n            lng: position.coords.longitude,\n          };\n        }\n\n        setLocation(coords);\n        await fetchNearbyVendors(coords.lat, coords.lng);\n      } catch (err) {\n        console.error(\"Error getting location:\", err);\n        setError(\"Could not determine your location. Showing vendors near Nairobi.\");\n        await fetchNearbyVendors(-1.2921, 36.8219);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchLocationAndVendors();\n  }, []);\n\n  const fetchNearbyVendors = async (lat, lng) => {\n    try {\n      const response = await fetch(`/vendors/nearby?lat=${lat}&lng=${lng}&radius=10`);\n      if (!response.ok) throw new Error('Failed to fetch vendors');\n      const data = await response.json();\n      setVendors(data);\n    } catch (err) {\n      console.error(\"Error fetching vendors:\", err);\n      setError(\"Failed to load nearby vendors. Please try again later.\");\n    }\n  };\n\n  if (loading) return <div className=\"text-center my-5\"><div className=\"spinner-border\" role=\"status\" /></div>;\n\n  if (error) {\n    return (\n      <div className=\"container mt-4\">\n        <div className=\"alert alert-danger\">{error}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container py-4\">\n      <h1 className=\"mb-3 text-primary\">Vendors Near You</h1>\n\n      <div className=\"alert alert-info\">\n        <p className=\"mb-1\">\n          <strong>Your location:</strong>{' '}\n          {location ? `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}` : 'Unknown'}\n        </p>\n        {vendors.length > 0 && (\n          <p className=\"mb-0\">\n            <strong>{vendors.length} vendor(s)</strong> within a 10 km radius\n          </p>\n        )}\n      </div>\n\n      <div className=\"row\">\n        {/* Left: List of vendors */}\n        <div className=\"col-md-5 mb-4\">\n          <h4 className=\"text-secondary mb-3\">Nearby Vendors</h4>\n          <div className=\"border rounded shadow-sm p-2 bg-white\" style={{ maxHeight: '520px', overflowY: 'auto' }}>\n            {vendors.length > 0 ? (\n              <ul className=\"list-group list-group-flush\">\n                {vendors\n                  .sort((a, b) => a.distance - b.distance)\n                  .map((vendor) => (\n                    <li\n                      key={vendor.id}\n                      className={`list-group-item list-group-item-action ${selectedVendor?.id === vendor.id ? 'active' : ''\n                        }`}\n                      role=\"button\"\n                      onClick={() => setSelectedVendor(vendor)}\n                    >\n                      <div className=\"d-flex justify-content-between align-items-center\">\n                        <strong>{vendor.username}</strong>\n                        <span className=\"badge bg-primary\">{vendor.distance.toFixed(1)} km</span>\n                      </div>\n                      <p className=\"mb-1 text-muted small\">{vendor.address}</p>\n                      <small className=\"text-secondary\">\n                        {vendor.products?.length || 0} product(s)\n                      </small>\n                    </li>\n                  ))}\n              </ul>\n            ) : (\n              <div className=\"text-muted text-center py-3\">No vendors found in your area.</div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Selected vendor details */}\n        <div className=\"col-md-7 mb-4\">\n          <h4 className=\"text-secondary mb-3\">Vendor Details</h4>\n          {selectedVendor ? (\n            <div className=\"bg-light border rounded shadow-sm p-3\">\n              <VendorCard vendor={selectedVendor} expanded />\n            </div>\n          ) : (\n            <div className=\"border border-2 border-dashed p-5 text-center text-muted rounded\">\n              <p>Select a vendor from the list to view more details</p>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default NearbyPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}